/**
  * addExecRight v1.0.0
  * (c) 2018-2022 ymc
  * @license MIT
  */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("node:fs"),require("node:child_process")):"function"==typeof define&&define.amd?define(["exports","node:fs","node:child_process"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["add-exec-right"]={},e.node_fs,e.node_child_process)}(this,(function(e,t,n){"use strict";
/**
    * runBash v0.0.3
    * (c) 2018-2022 ymc
    * @license MIT
    */function i(e){return e.split(/\r?\n/).map((e=>e.trim())).filter((e=>e)).join("\n")}const o=(e,t,o)=>new Promise(((s,a)=>{o||(o=t,t=e,e="");const c=((e,t=" ")=>Array.isArray(e)?e.join(t):e)(t);(o.exec?o.exec:n.exec)(`${e=e?`${e} ${c}`:`${c}`}`,o,((e,t,n)=>{const{fixUnreadbleCode:c}=o;if(c){const{iconvDesEncoding:e,iconvSrcEncoding:i}=o;t&&(t=c(t,e,i)),n&&(n=c(n,e,i))}e&&o.exitWhenErr&&a(e),o.noTrimOut||(t=i(t),n=i(n)),o.rejectStderr&&(n&&a(e),s(t)),s({stdout:t,stderr:n})}))})),s={exec:n.exec};function a(e){
/**
    * extendString v1.0.0
    * (c) 2018-2022 ymc
    * @license MIT
    */
return function(e){return e.replace(/(?:^\w|[A-Z_-]|\b\w)/g,((e,t)=>{let n="";return n=e.replace(/[-_]+/g," "),n=0!==t?n.replace(/[A-Z]/," $&"):n,0===t?n.toUpperCase():n.toLowerCase()})).replace(/\s+/g," ")}(e).replace(/(?:^\w|[A-Z]|\b\w)/g,((e,t)=>0===t?e.toLowerCase():e.toUpperCase())).replace(/\s+/g,"")}
/**
    * cliParam v1.0.0
    * (c) 2018-2022 ymc
    * @license MIT
    */function c(e,t={}){let n={};const i=Object.keys(e).map((t=>e[t])),o={slim:!0,modeStyle:"cli",...t};"string"===o.mode&&(o.slim=!0);for(let e=0;e<i.length;e+=1){const t=i[e],{name:s,type:c,value:r,desc:l}=t,[u,d]=s.split(/,/).map((e=>e.trim().replace(/^-*/gi,""))),h=u.length>1?u:d;if(h){if(o.noAutoCamelize||(n[a(h)]=r),o.slim)continue;n[h]=r}n[u]=r}return"string"===o.mode&&(n=function(e,t){const n={modeStyle:"cli",...t};let i="";return"string"===n.mode&&"cli"===n.modeStyle&&(i=Object.keys(e).map((t=>t.length>1?`--${t}=${e[t]}`:`-${t}=${e[t]}`)).join(" ")),"string"===n.mode&&"httpquery"===n.modeStyle&&(i=Object.keys(e).map((t=>`${t}=${e[t]}`)).join("&")),"string"===n.mode&&"swithoption"===n.modeStyle&&(i=Object.keys(e).map((t=>`${t}=${e[t]}`)).join(";")),i}(n,o)),n}function r(e,t={}){return c(e,t)}function l(e,t={}){let n;const{entrys:i}=t;return n=e.flags||i&&i.notOnlyFlags?e.flags:e,function(e={},t={}){const n={slim:!0,...t};return n.noAutoCamelize||Object.keys(e).forEach((t=>{const i=a(t);i!==t&&(e[i]=e[t],n.slim&&delete e[t])})),e}(n,t)}
/**
    * limitAsyncHandle v1.0.0
    * (c) 2018-2022 ymc
    * @license MIT
    */const{log:u}=console;class d{constructor(e){this.init(e)}init(e){return this._max=e,this._count=0,this._taskQueue=[],this._debug=!1,this._cb=null,this}call(e,...t){return new Promise(((n,i)=>{const o=this._createTask(e,t,n,i);this._count>=this._max?this._taskQueue.push(o):o()}))}_createTask(e,t,n,i){return()=>{e(...t).then(n).catch(i).finally((()=>{this._next()})),this._nextTick()}}_next(){if(this._count-=1,this._taskQueue.length){this._taskQueue.shift()()}else this._debug&&u("task count = ",this._count),this._cb&&this._cb()}_nextTick(){this._count+=1,this._debug&&u("task count = ",this._count)}}new d;
/**
    * kindOf v1.0.0
    * (c) 2018-2022 ymc
    * @license MIT
    */
const{toString:h}=Object.prototype,f=(p=Object.create(null),e=>{const t=h.call(e);return p[t]||(p[t]=t.slice(8,-1).toLowerCase())});var p;const{log:m}=console;function g(){return[{name:"-h,--help",type:"boolean",value:!1,desc:"info help"},{name:"-v,--version",type:"string",value:"1.0.0",desc:"info version"},{name:"-p,--bin-path",type:"string",value:"bin",desc:"the location of bin path"},{name:"--ext",type:"string",value:".js,.sh",desc:"only for matched file extention"},{name:"--update-by-git",type:"boolean",value:!1,desc:"run git update-index --chmod=+x xx or not"},{name:"--check-git",type:"boolean",value:!1,desc:"check if git init"},{name:"--verbose",type:"boolean",value:!1,desc:"info file right info or not"},{name:"--file-head",type:"string",value:"",desc:"add file head, custom file head"}]}e.main=async function(e={}){const n={...r([{name:"-h,--help",type:"boolean",value:!1,desc:"info help"},{name:"-v,--version",type:"string",value:"1.0.0",desc:"info version"},{name:"-p,--bin-path",type:"string",value:"bin",desc:"the location of bin path"},{name:"--ext",type:"string",value:".js,.sh",desc:"only for matched file extention"},{name:"--update-by-git",type:"boolean",value:!1,desc:"run git update-index --chmod=+x xx or not"},{name:"--check-git",type:"boolean",value:!1,desc:"check if git init"},{name:"--verbose",type:"boolean",value:!1,desc:"info file right info or not"},{name:"--file-head",type:"string",value:"",desc:"add file head, custom file head"}]),...l(e)},i=n.binPath;let a,c=t.readdirSync(i).map((e=>`${i}/${e}`)).filter((e=>t.statSync(e).isFile()));if(n.ext){const{ext:e}=n,t=e.split(",").map((e=>new RegExp(`${e}$`)));c=c.filter((e=>t.some((t=>t.test(e)))))}
/**
    * promiseAll v1.0.0
    * (c) 2018-2022 ymc
    * @license MIT
    */
var u,h;let p;a=c.map((e=>{return t={...n,file:e},async()=>{let e,n=`chmod +x ${t.file}`;return m(`[info] run: ${n}`),e=await o(n,s),t.updateByGit&&(n=`git update-index --chmod=+x ${t.file}`,m(`[info] run: ${n}`),e=await o(n,s)),e};var t})),await(u=a,h=3,new Promise(((e,t)=>{const n=h||u.length,i=new d(n),o=[],s=t=>{let n=u[t];return"asyncfunction"===f(n)?n=n():"function"===f(n)&&(n=Promise.resolve(n())),n.then((e=>{i._debug?o[t]={index:t,data:e,state:"ok"}:o[t]=e}),(e=>{i._debug?o[t]={index:t,state:"no",error:e}:o[t]=e})).finally((()=>{i._cb=()=>{
//! this._taskQueue.length && this._count===0
0===i._count&&e(o)}}))};for(let e=0;e<u.length;e+=1)i.call(s,e)}))),n.verbose||(p=await o(`ls ${i} -l`,s),m(p))},e.param=g,Object.defineProperty(e,"__esModule",{value:!0})}));
