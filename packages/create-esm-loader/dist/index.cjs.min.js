/**
  * createEsmLoader v1.0.0
  * (c) 2018-2022 ymc
  * @license MIT
  */
"use strict";function t(t){if(t&&t.__esModule)return t;var o=Object.create(null);return t&&Object.keys(t).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(o,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}})),o.default=t,Object.freeze(o)}
/**
  * compareVersion v1.0.0
  * (c) 2018-2022 ymc
  * @license MIT
  */function o(t,o){const r=`${o}`;let n=[];if(t){let t=r.split("-")[1];n=r.split("-")[0].split("."),t=t.split("."),n=n.concat(t)}else n=r.split(".");return n}function r(t){return t.map((t=>Number.isNaN(t)?t:parseInt(t)))}function n(t,n){const e=`${t}`,s=`${n}`,i=e.indexOf("-")>-1,a=s.indexOf("-")>-1;let c=o(i,e),f=o(a,s);c=r(c),f=r(f);const u=Math.max(c.length,f.length);for(let t=0;t<u;t+=1){if(3===t&&(void 0===c[t]||void 0===f[t])){if(void 0===c[t]&&Number.isNaN(f[t]))return 1;if(Number.isNaN(c[t])&&void 0===f[t])return-1}if(void 0===c[t])return-1;if(void 0===f[t])return 1;if(c[t]>f[t])return 1;if(c[t]<f[t])return-1}return 0}function e(t){return async function(...o){return{shortCircuit:!0,...await t(...o)}}}function s(t){return t?Array.isArray(t)?t.flat(1/0):[t]:[]}function i(t,o){return Object.prototype.hasOwnProperty.call(t,o)}function a(){}function c(t){return"string"==typeof t?{loader:t,options:{}}:i(t,"loader")?{loader:t.loader,options:{...t.options}}:i(t,"hooks")?t:{hooks:t,options:{}}}const f=["resolve","format","fetch","transform"];function u(){return function(t){return t.reduce(((t,o)=>(t[o]=[],t)),{})}(f)}class l{constructor(t={},o={}){i(t,"loaders")&&({loaders:t,options:o={}}=t),this.options=o,this.stack=null;const r=new Promise((async o=>{this.stack=await this.buildStack(t),o(this)}));this.ready=()=>r}async handleStack(t,o,r,n){const e=this.stack[t]||[],s={...this.options};for(const{fn:t,options:n}of e){const e={...s,...n,...r},i=await t(o,e);if(i)return i}return n(o,r,n)}hooks(){const t=t=>(...o)=>this.handleStack(t,...o),o=e(t("resolve")),r=t("format"),s=t("fetch"),i=async(t,o,r)=>{const n=this.stack.transform||[],e={...this.options};let s=t,i=!0;for(const{fn:t,options:r}of n){const n={...e,...r,...o},a=await t(s,n);(a||"string"==typeof a)&&(i=!1,s="string"==typeof a?a:a.source)}return i?r(t,o,r):{source:s}};if(function(t,o){const r=/=|>|</,e=o.match(r);let s,i;return e?([s]=e,[,i]=o.split(r)):i=o,"<"===s?-1===n(t,i):"="===s?0===n(t,i):">"===s?1===n(t,i):n(t,i)>=0}(process.version,"<16.12.0"))return{resolve:o,getFormat:r,getSource:s,transformSource:i};return{resolve:o,load:e((async(t,o,n)=>{const e=(t={})=>t.format;let{format:c=await r(t,o,a).then(e)}=o;const{source:f}=await s(t,o,(async(t,o)=>{const r=await n(t,{format:c});return c||(c=r.format),r})),u=await i(f,{url:t,format:c},(t=>({source:t})));return{format:c,source:u.source}}))}}async buildStack(o){const r=s(o).flat(1/0),n=[],e=u();for(const o of r){const r=c(o);if("string"!=typeof r.loader)this.fill(r,e);else{const o=u();for(const t of f){e[t].push(o[t])}n.push((async()=>{var n;const e=c({hooks:(await(n=r.loader,Promise.resolve().then((function(){return t(require(n))})))).default,options:r.options});this.fill(e,o)})())}}await Promise.all(n);for(const t of f)e[t]=e[t].flat(1/0);return e}fill(t,o){const{hooks:r,options:n}=t;for(const t of f){const e=o[t],i=s(r[t]);for(const t of i)e.push({fn:t,options:n})}}}module.exports=async function(...t){return(await new l(...t).ready()).hooks()};
