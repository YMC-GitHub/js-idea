/**
  * esmLoader v1.0.0
  * (c) 2018-2022 ymc
  * @license MIT
  */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("node:path"),require("node:url"),require("node:fs")):"function"==typeof define&&define.amd?define(["exports","node:path","node:url","node:fs"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["esm-loader"]={},e.node_path,e.node_url,e.node_fs)}(this,(function(e,t,n,r){"use strict";
/**
    * streamIo v1.0.0
    * (c) 2018-2022 ymc
    * @license MIT
    */function s(e){return new Promise(((t,n)=>{let r="";e.on("data",(e=>{r+=e.toString()})).on("end",(()=>{t(r)})).on("error",n)}))}function i({stream:e,data:t}){return new Promise(((n,r)=>{e.write(t,"utf-8"),e.end(),e.on("finish",(()=>{n(t)})).on("error",r)}))}
/**
    * jsonStreamIo v1.0.0
    * (c) 2018-2022 ymc
    * @license MIT
    */class a{constructor(e,t){this.init(e,t)}async read(e={}){const{file:t}=this;let n,i;try{n=r.createReadStream(t.name),i=await s(n),i=JSON.parse(i)}catch(t){i=e}return t.data=i,i}async write(e){const{file:t,option:n}=this;let s,a=e;try{s=r.createWriteStream(t.name),e?t.data=e:a=t.data,await i({stream:s,data:JSON.stringify(a,null,2)})}catch(e){}}init(e="package.json",t={}){this.file={name:e,data:t},this.option={}}new(...e){return new a(...e)}}const o=new a;
/**
    * textStreamIo v1.0.0
    * (c) 2018-2022 ymc
    * @license MIT
    */class c{constructor(e="CHANGELO.md"){this.init(e)}async read(e=""){const{file:t}=this;let n,i;try{n=r.createReadStream(t.name),i=await s(n)}catch(t){i=e}return t.data=i,i}async write(e){const{file:t,option:n}=this;let s,a,o;switch(s=r.createWriteStream(t.name),a=t.data,n.writemode){case"override":default:o=`${e}`;break;case"append":o=`${a}\n${e}`;break;case"head":o=`${e}\n${a}`}t.data=o,await i({stream:s,data:o})}init(e="CHANGELO.md",t=""){return this.file={name:e,data:t},this.option={},this}new(...e){return new c(...e)}}const l=new c;
/**
    * compareVersion v1.0.0
    * (c) 2018-2022 ymc
    * @license MIT
    */function f(e,t){const n=`${t}`;let r=[];if(e){let e=n.split("-")[1];r=n.split("-")[0].split("."),e=e.split("."),r=r.concat(e)}else r=n.split(".");return r}function u(e){return e.map((e=>Number.isNaN(e)?e:parseInt(e)))}function d(e,t){const n=`${e}`,r=`${t}`,s=n.indexOf("-")>-1,i=r.indexOf("-")>-1;let a=f(s,n),o=f(i,r);a=u(a),o=u(o);const c=Math.max(a.length,o.length);for(let e=0;e<c;e+=1){if(3===e&&(void 0===a[e]||void 0===o[e])){if(void 0===a[e]&&Number.isNaN(o[e]))return 1;if(Number.isNaN(a[e])&&void 0===o[e])return-1}if(void 0===a[e])return-1;if(void 0===o[e])return 1;if(a[e]>o[e])return 1;if(a[e]<o[e])return-1}return 0}function m(e,n){const r=function(e){const n=t.resolve(process.cwd(),"."),{alias:r={}}=e;return Object.keys(r).forEach((e=>{const s=r[e];r[e]=function(e,t=".",n=/^<root>/i){return e.replace(n,t)}(s),r[e]=t.resolve(n,r[e])})),r}(n),s=Object.keys(r);for(let t=0;t<s.length;t+=1){const n=s[t],i=r[n];if(e.startsWith(n)){const t=new RegExp(`^${n}`),r=e.replace(t,"");e=`file:///${e=(e=`${i}/${r}`).replace(/\\/gi,"/")}`}}return e}const{log:p}=console,h=function(e="module-alias.json"){return function(e,t={}){let n;try{n=r.readFileSync(e),n=JSON.parse(n)}catch(e){n=t}return n}(e,{})}(),w=d(process.version,"14.13.1")>=0||d(process.version,"12.20.0")>=0;function y(e){y.enable&&p(e)}async function g(e,t,n){const r=[".js",".json",".ts",".tsx",".jsx"],{extensions:s=r}=t;let i,a;for(const r of s)try{return y(`[info] try reslove ${e+r}`),i=await n(e+r,t,n),i}catch(e){if(void 0===a){const{message:t}=e;e.message=e.message.replace(`${r}'`,"'"),e.stack=e.stack.replace(t,e.message),a=e}}throw a}async function v(e,n,r){let s;if(s=await async function(e,t,n){let r;y("[info] try resolve module,main,browser and other key in package.json");const s=await async function(e,t,n){const{packagejsonIndexOrder:r="jsnext -> browser"}=t,s=e.endsWith("/");let i,a,c,l;i="package.json",a=s?e+i:`${e}/${i}`,a=a.replace("file:///",""),o.init(a),c=await o.read({}),l=[c.main,c.module],"module"===c.type&&(l=[c.module,c.main]);l=[...l,...f(r)],l=l.filter((e=>e)),s||(l=l.map((e=>`/${e}`)));return l;function f(e="module -> main",t=/ ?-> ?/){return e.split(t).filter((e=>e)).map((e=>c[e])).filter((e=>e))}}(e,t);let i;if(s.length<0)return r;for(const a of s)try{return y(`[info] try resolve ${e+a}`),r=await n(e+a,t,n),r}catch(e){if(void 0===i){const{message:t}=e;e.message=e.message.replace(`${a}'`,"'"),e.stack=e.stack.replace(t,e.message),i=e}throw i}}(e,n,r),s)return s;let i="index";const a=e.endsWith("/")?i:"/index";try{return s=await g(e+a,n,r),s}catch(e){const{message:n}=e;throw e.message=e.message.replace(`${a.replace("/",t.sep)}'`,"'"),e.stack=e.stack.replace(n,e.message),e}}y.enable=!1,e.load=async function(e,t,r){const s=e.split("?")[0];return[".md",".css",".html",".htm",".svg"].some((e=>s.endsWith(e)))?await async function(e){l.init(new n.URL(e));const t=await l.read("");return{format:"module",source:`export default ${JSON.stringify(t.toString())};`,shortCircuit:!0}}(e):r(e,t,r)},e.resolve=async function(e,n,r,s){if(y("[info] compact node lib expression"),!w&&e.startsWith("node:")&&(e=e.slice(5)),y("[info] reslove alias"),e=m(e,h),y("[info] reslove dirs"),e.endsWith("/"))return await v(e,n,r);let i;y("[info] reslove next");try{i=await r(e,n,r)}catch(t){if(t instanceof Error&&!s){if("ERR_UNSUPPORTED_DIR_IMPORT"===t.code)return y("[info] recursive reslove dirs"),await v(e,n,r);if("ERR_MODULE_NOT_FOUND"===t.code)return y("[info] recursive reslove exts"),await g(e,n,r)}throw t}if(i.url.endsWith(".json"))return{...i,format:"json"};let{format:a}=i;if(i.url.startsWith("file://")){a=function(e){const n=t.extname(e);if(".mjs"===n||".mts"===n)return"module";if(".cjs"===n||".cts"===n)return"commonjs"}(i.url)||a}return{...i,format:a}},Object.defineProperty(e,"__esModule",{value:!0})}));
