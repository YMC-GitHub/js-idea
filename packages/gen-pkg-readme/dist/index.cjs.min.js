/**
  * genPkgReadme v1.0.0
  * (c) 2018-2022 ymc
  * @license MIT
  */
"use strict";var e=require("node:fs");
/**
  * renderTpl v1.0.0
  * (c) 2018-2022 ymc
  * @license MIT
  */function n(e,n){let t=e;return Object.keys(n).forEach((e=>{const o=n[e];t=t.replace(new RegExp(`{${e}}`,"ig"),o)})),t}const t=/({|})|(\[|\])|(\(|\))/gi,o=(e,n=t)=>e.replace(n,"\\$&"),r=(e,n={})=>((e,n={})=>{const t={regexpOption:"ig",...n};let{openLabel:r,closeLabel:i,regexpOption:a}=t;return t.excapeSpecialChars&&(r=o(r,t.specialCharsReg),i=o(i,t.specialCharsReg)),new RegExp(`${r}${e}${i}`,a)})(e,{excapeSpecialChars:!0,specialCharsReg:t,...n});const{log:i}=console;function a(n,t=""){let o;try{o=e.readFileSync(n),o=o.toString()}catch(e){o=t}return o}function c(n,t={}){let o;try{o=e.readFileSync(n),o=JSON.parse(o)}catch(e){o=t}return o}function l(e,n="{{",t="}}"){return r(e,{openLabel:n,closeLabel:t})}function s(e,n={}){return(t="",o="")=>{const r={tpl:"",joinMode:"foot",..."string"==typeof n?{tpl:n}:n};let i=t;const a=l(e);return a.test(i)||(i=r.tpl),i=i.replace(a,o),i}}module.exports=function(t){i(`[info] wkd is: ${t}`),i("[task] gen pkg readme"),i("[info] load pkg-json data");const o=c(`${t}/package.json`);let r,p,f,u;i("[info] load readme tpl"),r=((e="readme",n=".")=>`${n}/${e}.tpl.md`)("readme",t),i(`[info] loc: ${r}`),p=a(r),i("[info] load lib-size data"),r=((e="readme",n=".")=>`${n}/${e}.tmp.md`)("lib-size",t),i(`[info] loc: ${r}`),f=a(r),u=function(e="",n=""){let t=e;const o=l("LIB_SIZE_INFO");return o.test(t)||(t=`\n${t}\n## Lib size  \n{{LIB_SIZE_INFO}}\n`.trim()),t=t.replace(o,n),t}(p,f),u=function(e,n){return s("LIB_NAME",` # Pkg {{LIB_NAME}}\n${e}`)(e,n)}(u,o.name),u=((e,n)=>{let t,o,r,i=e;if(t="description",t in n&&n[t]&&(o=n[t],r="\n## Desc\n{{PKG_DESC}}\n".trim(),i=s("PKG_DESC",r)(i,o)),t="license",t in n&&n[t]&&(o=n[t],r="\n## License\n{{LICENSE}}\n".trim(),i=s("LICENSE",r)(i,o)),t="author",t in n&&n[t]){o=n[t];const{name:e}=o,{email:a}=o;o=a?`${e} <${a}>`:`${e}`,r="\n## Author\n{{AUTHOR_LIST}}\n".trim(),i=s("AUTHOR_LIST",r)(i,o)}return i})(u,o),i("[info] load pkgs state data");let d=c("pkgs-info.json");d=d.filter((e=>e.name===o.name)),[d]=d,i("[info] load pkg-state tpl"),r="pkgs-state.tpl.tmp.md",i(`[info] loc: ${r}`),p=a(r),p=function(e,t){return t?n(e,t):t=>n(e,t)}(p,d),u=`${p}\n${u}`,function(n,t=""){try{e.writeFileSync(n,t)}catch(e){}}(`${t}/readme.md`,u)};
