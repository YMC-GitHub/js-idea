/**
  * jcm v0.0.1
  * (c) 2018-2022 ymc
  * @license MIT
  */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).jcm={})}(this,(function(t){"use strict";const{log:e}=console;class i{constructor(){this.list=[],this.index=-1,this.freeze=!1}use(t={},e){let{list:i,index:n}=this;const s=!e;return s||n==e?n++:n<e&&(n=e),this.index=n,n=s?n:e,t&&(i[n]=t),this}load(){const{list:t}=this;let e={};for(let i=0;i<t.length;i++){const n=t[i];n&&(e={...e,...n})}const{freeze:i}=this;return i?Object.freeze(e):e}}class n{constructor(){this.data={},this.option={splitChar:"."}}bind(t){return t&&(this.data=t),this}split(t="."){return t&&(this.option.splitChar=t),this}conf(t="",i){if(!t)return this;let n,{data:s,option:o}=this;n=(t=t.split(o.splitChar))[t.length-1];const{length:l}=t;for(let e=0;e<l-1;e++){const i=t[e];s[i]||(s[i]={}),s=s[i]}return null==i?s[n]:(s[n]=i,e(`set ${n} ${i}`),this)}}new i,new n;const{log:s}=console;class o{constructor(){this.option={},this.tool={}}getFileLoc(t){let{option:e,tool:i}=this,n=t||e.name,o=e;return o.usd||o.u?i.joinPath(i.getUserHome(),n):o.crd||o.c?n:o.wkd?(s(n,e),i.joinPath(o.wkd,n)):n}getFileLocList(t){let e=[],{option:i}=this;return e=[["usd","u"],["crd","c"],["wkd"]].map((e=>{let n,s,o;for(let t=0;t<e.length;t++){const l=e[t];if(i[l]){s=i[l],n=l,o=!0;break}}return!!o&&(this.option={[`${n}`]:s,name:i.name},this.getFileLoc(t))})).filter((t=>t)),this.option=i,e}magicReadConfig(t=".ymcrc.json"){let{tool:e}=this;return function(t=[".ymcrc.json"],e){const n=new i;for(let i=0;i<t.length;i++){const s=t[i];n.use(e(s))}return n.load()}(this.getFileLocList(t),e.readJson)}magicDefineConfig(t,e,i){const s=new n;return s.bind(t),s.split("/"),s.conf(e,i),s.data}getJsonVal(t="key",e="val"){let i,{data:n}=this;if(t)return i=n[e],s(i),i}setJsonVal(t,e,i){let n,s,{option:o,tool:l}=this,r=this,{name:c}=o;n=r.magicReadConfig(c),t&&i&&(n=r.magicDefineConfig(n,t,e)),s=r.getFileLocList(c),s=s[s.length-1];let a=l.parsePath(s).dir;a&&l.addDirs(a),o.dryrun||l.saveJson(s,n),this.data=n}comEntry(t){let e,i,n,{option:o,tool:l}=this,{name:r}=o,c={};if("cnf"==t){let s=Object.keys(o),l="name|wkd|usd|crd|w|u|c".split("|");e=s.filter((t=>!l.includes(t)))[0],i=o[e],n=e in o,t=n?"add":"get"}else e=o.key,i=o.val,n="val"in o;switch(t){case"add":this.setJsonVal(e,i,n);break;case"del":break;default:c=this.magicReadConfig(r),this.getJsonVal(e,i),s("[info] info data:"),s(c)}return c}}const l=new o;t.Jcm=o,t.jcm=l,Object.defineProperty(t,"__esModule",{value:!0})}));
