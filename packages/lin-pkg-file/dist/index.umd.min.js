/**
  * linPkgFile v1.0.0
  * (c) 2018-2022 ymc
  * @license MIT
  */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("node:child_process"),require("node:fs")):"function"==typeof define&&define.amd?define(["exports","node:child_process","node:fs"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["lin-pkg-file"]={},e.node_child_process,e.node_fs)}(this,(function(e,t,n){"use strict";
/**
    * runBash v0.0.3
    * (c) 2018-2022 ymc
    * @license MIT
    */function o(e){return e.split(/\r?\n/).map((e=>e.trim())).filter((e=>e)).join("\n")}const r=(e,n,r)=>new Promise(((i,s)=>{r||(r=n,n=e,e="");const a=((e,t=" ")=>Array.isArray(e)?e.join(t):e)(n);(r.exec?r.exec:t.exec)(`${e=e?`${e} ${a}`:`${a}`}`,r,((e,t,n)=>{const{fixUnreadbleCode:a}=r;if(a){const{iconvDesEncoding:e,iconvSrcEncoding:o}=r;t&&(t=a(t,e,o)),n&&(n=a(n,e,o))}e&&r.exitWhenErr&&s(e),r.noTrimOut||(t=o(t),n=o(n)),r.rejectStderr&&(n&&s(e),i(t)),i({stdout:t,stderr:n})}))})),i={exec:t.exec};
/**
    * jsonStreamIo v1.0.0
    * (c) 2018-2022 ymc
    * @license MIT
    */
class s{constructor(e,t){this.init(e,t)}async read(e={}){const{file:t}=this;let o,r;try{o=n.createReadStream(t.name),r=await(i=o,new Promise(((e,t)=>{let n="";i.on("data",(e=>{n+=e.toString()})).on("end",(()=>{e(n)})).on("error",t)}))),r=JSON.parse(r)}catch(t){r=e}
/**
    * streamIo v1.0.0
    * (c) 2018-2022 ymc
    * @license MIT
    */
var i;return t.data=r,r}async write(e){const{file:t,option:o}=this;let r,i=e;try{r=n.createWriteStream(t.name),e?t.data=e:i=t.data,await function({stream:e,data:t}){return new Promise(((n,o)=>{e.write(t,"utf-8"),e.end(),e.on("finish",(()=>{n(t)})).on("error",o)}))}({stream:r,data:JSON.stringify(i,null,2)})}catch(e){}}init(e="package.json",t={}){this.file={name:e,data:t},this.option={}}new(...e){return new s(...e)}}const a=new s;const{log:c}=console;function l(e,t="done",n="fail"){let o=n;return e&&(o=t),o}function f(e,t,n,o){return o.some((t=>t.name===e))?o.forEach((o=>{o.name===e&&(o[t]=n)})):o.push({name:e,[`${t}`]:n}),o}e.exec=r,e.execOpts=i,e.getFailOrDone=l,e.getLibNameFromPath=function(e,t={}){let n=function(e){const t=e.split(/\/?\\|\//);return t[t.length-1]}(e);const o={trim:!0,...t};return o.trim&&(n=n.trim()),o.camelize&&(n=
/**
    * extendString v1.0.0
    * (c) 2018-2022 ymc
    * @license MIT
    */
function(e){return e.replace(/(?:^\w|[A-Z_-]|\b\w)/g,((e,t)=>{let n="";return n=e.replace(/[-_]+/g," "),n=0!==t?n.replace(/[A-Z]/," $&"):n,0===t?n.toUpperCase():n.toLowerCase()})).replace(/\s+/g," ")}(n).replace(/(?:^\w|[A-Z]|\b\w)/g,((e,t)=>0===t?e.toLowerCase():e.toUpperCase())).replace(/\s+/g,"")),n},e.getPackagesLocFromPath=function(e){return function(e,t="/"){const n=e.split(/\/?\\|\//);return n.slice(0,n.length-1).join(t)}(e)},e.jsonstream=a,e.putPkgsInfo=f,e.runeslint=async function(e,t){c(`[info] run cmd: ${e}`);const{stderr:n,stdout:o}=await r(e,t);let i;return n&&c(n),c(o),i=""===n?"passing":"fail",c(`[info] lint files ${i}`),l(!0,i)},e.setLinState=async function(e={}){const t={key:"lin_state",state:"todo",storeAt:"pkgs-info.json",...e};let n=t.pkgLoc;c("[info] set lint state in store"),a.init(`${t.pkgLoc}/package.json`);const o=await a.read({});n=t.storeAt,a.init(`${n}`);const r=await a.read([]);f(o.name,t.key,t.state,r),await a.write(r),c(`[info] out: ${n}`)},Object.defineProperty(e,"__esModule",{value:!0})}));
