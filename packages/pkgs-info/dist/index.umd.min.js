/**
  * pkgsInfo v1.0.0
  * (c) 2018-2022 ymc
  * @license MIT
  */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("node:fs")):"function"==typeof define&&define.amd?define(["exports","node:fs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["pkgs-info"]={},t.node_fs)}(this,(function(t,e){"use strict";
/**
    * extendString v1.0.0
    * (c) 2018-2022 ymc
    * @license MIT
    */
/**
    * jsonStreamIo v1.0.0
    * (c) 2018-2022 ymc
    * @license MIT
    */
class n{constructor(t,e){this.init(t,e)}async read(t={}){const{file:n}=this;let a,o;try{a=e.createReadStream(n.name),o=await(i=a,new Promise(((t,e)=>{let n="";i.on("data",(t=>{n+=t.toString()})).on("end",(()=>{t(n)})).on("error",e)}))),o=JSON.parse(o)}catch(e){o=t}
/**
    * streamIo v1.0.0
    * (c) 2018-2022 ymc
    * @license MIT
    */
var i;return n.data=o,o}async write(t){const{file:n,option:a}=this;let o,i=t;try{o=e.createWriteStream(n.name),t?n.data=t:i=n.data,await function({stream:t,data:e}){return new Promise(((n,a)=>{t.write(e,"utf-8"),t.end(),t.on("finish",(()=>{n(e)})).on("error",a)}))}({stream:o,data:JSON.stringify(i,null,2)})}catch(t){}}init(t="package.json",e={}){this.file={name:t,data:e},this.option={}}new(...t){return new n(...t)}}const a=new n;
/**
    * chainTask v1.0.0
    * (c) 2018-2022 ymc
    * @license MIT
    */async function o(t){const e=[];let n=Promise.resolve(null);for(let a=0;a<t.length;a++){const o=t[a];n=n.then((async t=>(e[a]=await o(),e[a]))).catch(console.log)}return await n,e}const{log:i}=console;async function s(t={}){const n={wkd:"./private-pkgs/noop",...t},o=function(t,e={}){let n=function(t){const e=t.split(/\/?\\|\//);return e[e.length-1]}(t);const a={trim:!0,...e};return a.trim&&(n=n.trim()),a.camelize&&(n=(o=n,o.replace(/(?:^\w|[A-Z_-]|\b\w)/g,((t,e)=>{let n="";return n=t.replace(/[-_]+/g," "),n=0!==e?n.replace(/[A-Z]/," $&"):n,0===e?n.toUpperCase():n.toLowerCase()})).replace(/\s+/g," ")).replace(/(?:^\w|[A-Z]|\b\w)/g,((t,e)=>0===e?t.toLowerCase():t.toUpperCase())).replace(/\s+/g,"")),n;var o}(n.wkd),i=function(t,e="/"){const n=t.split(/\/?\\|\//);return n.slice(0,n.length-1).join(e)}(n.wkd);const s=`${i}/${o}/package.json`;a.init(s);const r=await a.read({}),{name:c,description:l}=r;let f=[],p=[];return[`${i}/${o}/package.json`,`${i}/${o}/src/index.js`].filter((t=>e.existsSync(t))).forEach((t=>{const{modifiedAt:n,createdAt:a}=function(t){const n=e.statSync(t),{birthtime:a,mtime:o,ctime:i}=n;let s=[o,i];return s=s.sort(((t,e)=>new Date(e)-new Date(t))),{modifiedAt:s[0],createdAt:a}}(t);f.push(n),p.push(a)})),f=f.sort(((t,e)=>new Date(e)-new Date(t))),p=p.sort(((t,e)=>new Date(t)-new Date(e))),[f]=f,[p]=p,{name:c,description:l,created_at:p,modified_at:f,loc:s}}async function r(t={}){const n={packagesLoc:["packages"],split:",",...t};let a=(Array.isArray(n.packagesLoc)?n.packagesLoc:n.packagesLoc.split(n.split)).map((t=>e.readdirSync(t).map((e=>({wkd:`${t}/${e}`,libname:e,packagesLoc:t}))))).flat(1/0);return a=a.filter((t=>e.statSync(t.wkd).isDirectory())),a}function c(t,e){const n={};return t.forEach((t=>{const{name:e}=t;n[e]=t})),e.forEach((t=>{const{name:e}=t;n[e]?n[e]={...n[e],...t}:n[e]=t})),Object.values(n)}t.codePkgsInfo=async function(t={}){let e,n,l,f,p;e=await r(t),n=e.map((t=>async()=>await s(t))),l=await o(n),f=t.storeAt?t.storeAt:"pkgs-info.json",a.init(f),p=await a.read([]);const d=c(l,p);await a.write(d),i(`[info] out: ${f}`)},t.pullPkgsInfo=async function(t={}){let e,n,l,f,p;e=await r(t),n=e.map((t=>async()=>await s(t))),l=await o(n),f=t.storeAt?t.storeAt:"pkgs-info.json",a.init(f),p=await a.read([]);const d=c(p,l);await a.write(d),i(`[info] out: ${f}`)},t.pushPkgsInfo=async function(t={}){let e,n,s;s=t.storeAt?t.storeAt:"pkgs-info.json",a.init(s),n=await a.read([]),e=n.map((t=>async()=>{a.init(t.loc);let e=await a.read({});e.description=t.description,await a.write(e),e=null})),i(`[info] out: ${s}`),await o(e)},t.putPkgsInfo=function(t,e,n,a){return a.some((e=>e.name===t))?a.forEach((a=>{a.name===t&&(a[e]=n)})):a.push({name:t,[`${e}`]:n}),a},Object.defineProperty(t,"__esModule",{value:!0})}));
